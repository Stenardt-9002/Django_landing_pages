{% extends "base.html" %}
<!-- grey lighten-3 -->

{% block extra_head %}
<style>

  /* body,html {
    height :100%;
    background-color: #f7f8f9;
    color: #6b7c93;
  } */
/* input, */
/* *,label { */
#stripeBtnLabel{
font-family: "Helvetica Neue", Helvetica, sans-serif;
  font-size: 16px;
  font-variant: normal;
  padding: 0;
  margin: 0;
  -webkit-font-smoothing: antialiased;
  font-weight: 500;
  display: block;;

}


#stripeBtn{
  border: none;
  border-radius: 4px;
  outline: none;
  text-decoration: none;
  color: #fff;
  background: #32325d;
  white-space: nowrap;
  display: inline-block;
  height: 40px;
  line-height: 40px;
  padding: 0 14px;
}
button:hover{
  transform:translate(-1px);
  box-shadow: 0 7px 14px rgba(50,50,93,.1), 03px 6px rgba(0,0,0,.08);
  background-color: #43458b;
}
#stripe-form{
  padding: 30 px;
  height :120px;
}
label{
  font-weight: 500;
  font-size: 14px;
  display: block;
  margin-bottom: 8px;
}

#card-errors{
  height: 20px;
  padding: 4px 0;
  color: #fa755a;
}

.stripe-form-row{
  width: 70%;
  float: left;
}

/* .token {
  color: #32325d;
  font-family: 'Source Code Pro',monospace;
  font-weight: 500;
} */

/* 
.wrapper{
  width:670px;
  margin: 0 auto;
  height: 100%;
}
#stripe-token-handler {
  position: absolute;
  top: 0;
  left: 25%;
  right: 25%;
  padding: 20px 30px;
  border-radius: 0 0 4px 4px;
  box-sizing: border-box;
  box-shadow: 0 50px 100px rgba(50,50 93,0.1) ,
  0 15px 35px rgba(50,50,93,0.15)
  ,0 5px 15px rgba(0,0,0,0.1);
  -webkit-transition : all 500ms ease-in-out;
  transform : translateY(0);
  opacity: 1;
  background-color: white;

}
#stripe-token-handler.is-hidden{
  opacity: 0;
  transform: translateY(-80px);
} */

.StripeElement {
  height: 40px;

  color: #32325d;
  background-color: white;
  border: 1px solid transparent;
  border-radius: 4px;

  box-shadow: 0 1px 3px 0 #e6ebf1;
  -webkit-transition: box-shadow 150ms ease;
  transition: box-shadow 150ms ease;
}

input {
  padding: 10px 12px;
}

input:focus,
.StripeElement--focus {
  box-shadow: 0 1px 3px 0 #cfd7df;
}

.StripeElement--invalid {
  border-color: #fa755a;
}

.StripeElement--webkit-autofill {
  background-color: #fefde5 !important;
}

</style>
{% endblock extra_head %}


{% block content %}

  <!-- <main class="mt-5 pt-4"> -->
    <main>
    <div class="container wow fadeIn">

      <!-- Heading -->
      <h2 class="my-5 h2 text-center">Payment Option</h2>

      <!--Grid row-->
      <div class="row">

        <!--Grid column-->
        <div class="col-md-12 mb-4">

          <!--Card-->
          <div class="card">

    

            <script src="https://js.stripe.com/v3/"></script>

            <form action="." method = "post" id="stripe-form">
              {% csrf_token %}
                <div class="stripe-form-row">
                    <label for="card-element" id="stripeBtnLabel" >
                        Credit or debit card
                    </label>
                    <!-- <div tabindex = -1 class="CardField CardField--ltr">
                      <div class=CardBrandIcon-container>
                        <div class="Icon CardBrandIcon">
                          
                          <svg focusable = "false" xmlns = "http://www.w3.org/2000/svg viewBox = " 0 0 32 21></svg>
                        </div>
                      </div>
                    </div> -->
                    
                    

                    <div id="card-element" class="StripeElement StripeElement--empty"><div class="__PrivateStripeElement" style="margin: 0px !important; padding: 0px !important; border: none !important; display: block !important; background: transparent !important; position: relative !important; opacity: 1 !important;"><iframe frameborder="0" allowtransparency="true" scrolling="no" name="__privateStripeFrame5" allowpaymentrequest="true" src="https://js.stripe.com/v3/elements-inner-card-19066928f2ed1ba3ffada645e45f5b50.html#style[base][color]=%2332325d&amp;style[base][fontFamily]=%22Helvetica+Neue%22%2C+Helvetica%2C+sans-serif&amp;style[base][fontSmoothing]=antialiased&amp;style[base][fontSize]=16px&amp;style[base][::placeholder][color]=%23aab7c4&amp;style[invalid][color]=%23fa755a&amp;style[invalid][iconColor]=%23fa755a&amp;componentName=card&amp;wait=false&amp;rtl=false&amp;keyMode=test&amp;origin=https%3A%2F%2Fstripe.com&amp;referrer=https%3A%2F%2Fstripe.com%2Fdocs%2Fstripe-js&amp;controllerId=__privateStripeController1" title="Secure payment input frame" style="border: none !important; margin: 0px !important; padding: 0px !important; width: 1px !important; min-width: 100% !important; overflow: hidden !important; display: block !important; height: 19.2px;"></iframe><input class="__PrivateStripeElement-input" aria-hidden="true" aria-label=" " autocomplete="false" maxlength="1" style="border: none !important; display: block !important; position: absolute !important; height: 1px !important; top: 0px !important; left: 0px !important; padding: 0px !important; margin: 0px !important; width: 100% !important; opacity: 0 !important; background: transparent !important; pointer-events: none !important; font-size: 16px !important;"></div></div>


                    <!-- <div class="StripeElement StripeElement--empty" id="card-element">
                      <div class="__PrivateStripeElement-input">

                      </div> -->
                    </div>
                    
                    <div id = "card-errors" role="alert"></div>    
                  </div>


                      <!-- <i class="fa fa-credit-card"></i> -->
                      <!-- <input class="__PrivateStripeElement-input" > -->
                      <!-- <input class="StripeElement StripeElement--empty " style="border-inline-width: 100rem;" id="card-element"> -->
                      <button id = "stripeBtn"  >Submit</button>
                  
                    <!-- Form error / -->
                        <!-- <div id = "card-errors" role = "alert"> -->

                        <!-- </div> -->
                        
                        
                        <!-- <button class="btn btn-primary">Submit Payment</button> -->

            </form>



          </div>
          <!--/.Card-->

        </div>
        <!--Grid column-->


        <div class="col-md-12 mb-4">

          <!-- Heading -->
          <h4 class="d-flex justify-content-between align-items-center mb-3">
            <span class="text-muted">Your cart</span>
            <span class="badge badge-secondary badge-pill">{{order.items.count}}</span>
          </h4>

          <!-- Cart -->
          <ul class="list-group mb-3 z-depth-1">
            {% for order_item in order.items.all %}

            <li class="list-group-item d-flex justify-content-between lh-condensed">
              <div>
                <h6 class="my-0">{{order_item.item.quantity}} x {{ order_item.item.title }}</h6>
                <small class="text-muted">{{ order_item.item.description }}</small>
              </div>
              <span class="text-muted">{{order_item.get_final_price}}</span>
            </li>

            {% endfor %}

            <li class="list-group-item d-flex justify-content-between lh-condensed">
              <div>
                <h6 class="my-0">Third item</h6>
                <small class="text-muted">Brief description</small>
              </div>
              <span class="text-muted">$5</span>
            </li>
            <li class="list-group-item d-flex justify-content-between bg-light">
              <div class="text-success">
                <h6 class="my-0">Promo code</h6>
                <small>EXAMPLECODE</small>
              </div>
              <span class="text-success">-$5</span>
            </li>
            <li class="list-group-item d-flex justify-content-between">
              <span>Total (USD)</span>
              <strong>{{order_item.get_total}}</strong>
            </li>
          </ul>
          <!-- Cart -->



        </div>


      </div>
      <!--Grid row-->

    </div>
  </main>



  <script nonce="">  // Create a Stripe client.
  var stripe = Stripe('');

  // Create an instance of Elements.
  var elements = stripe.elements();

  // Custom styling can be passed to options when creating an Element.
  // (Note that this demo uses a wider set of styles than the guide below.)
  var style = {
    base: {
      color: '#32325d',
      fontFamily: '"Helvetica Neue", Helvetica, sans-serif',
      fontSmoothing: 'antialiased',
      fontSize: '16px',
      '::placeholder': {
        color: '#aab7c4'
      }
    },
    invalid: {
      color: '#fa755a',
      iconColor: '#fa755a'
    }
  };

  // Create an instance of the card Element.
  var card = elements.create('card', {style: style});

  // Add an instance of the card Element into the `card-element` <div>.
  card.mount('#card-element');

  // Handle real-time validation errors from the card Element.
  card.addEventListener('change', function(event) {
    var displayError = document.getElementById('card-errors');
    if (event.error) {
      displayError.textContent = event.error.message;
    } else {
      displayError.textContent = '';
    }
  });

  // Handle form submission.
  var form = document.getElementById('stripe-form');
  form.addEventListener('submit', function(event) {
    event.preventDefault();

    stripe.createToken(card).then(function(result) {
      if (result.error) {
        // Inform the user if there was an error.
        var errorElement = document.getElementById('card-errors');
        errorElement.textContent = result.error.message;
      } else {
        // Send the token to your server.
        stripeTokenHandler(result.token);
      }
    });
  });

  // Submit the form with the token ID.
  function stripeTokenHandler(token) {
    // Insert the token ID into the form so it gets submitted to the server
    var form = document.getElementById('stripe-form');
    var hiddenInput = document.createElement('input');
    hiddenInput.setAttribute('type', 'hidden');
    hiddenInput.setAttribute('name', 'stripeToken');
    hiddenInput.setAttribute('value', token.id);
    form.appendChild(hiddenInput);

    // Submit the form
    form.submit();
  }

</script>












<!--

  <script>

        var stripe = Stripe('pk_test_6pRNASCoBOKtIshFeQd4XMUh');

        // Create an instance of Elements.
        var elements = stripe.elements();

        // Custom styling can be passed to options when creating an Element.
        // (Note that this demo uses a wider set of styles than the guide below.)
        var style = {
        base: {
            padding: '10px 12px',
            color: '#32325d',
            fontFamily: '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif',
            fontSmoothing: 'antialiased',
            fontSize: '16px',
            '::placeholder': {
            color: '#aab7c4'
            },
        },
        invalid: {
            color: '#fa755a',
        }
        };

        // Create an instance of the idealBank Element.
        // var idealBank = elements.create('idealBank', {style: style});

        // Add an instance of the idealBank Element into the `ideal-bank-element` <div>.
        // idealBank.mount('#ideal-bank-element');

        // var errorMessage = document.getElementById('error-message');

        // Handle form submission.
        // var form = document.getElementById('payment-form');
        // var form = document.getElementById('stripe-form');
        
        // form.addEventListener('submit', function(event) {
        // event.preventDefault();
        // showLoading();

        // var sourceData = {
        //     type: 'ideal',
        //     amount: 1099,
        //     currency: 'eur',
        //     owner: {
        //     name: document.querySelector('input[name="name"]').value,
        //     },
        //     // Specify the URL to which the customer should be redirected
        //     // after paying.
        //     redirect: {
        //     return_url: 'https://shop.example.com/crtA6B28E1',
        //     },
        // };

        // // Call `stripe.createSource` with the idealBank Element and additional options.
        // stripe.createSource(idealBank, sourceData).then(function(result) {
        //     if (result.error) {
        //     // Inform the customer that there was an error.
        //     errorMessage.textContent = result.error.message;
        //     errorMessage.classList.add('visible');
        //     stopLoading();
        //     } else {
        //     // Redirect the customer to the authorization URL.
        //     errorMessage.classList.remove('visible');
        //     stripeSourceHandler(result.source);
        //     }
        // });
        // });
var card = elements.create('card',{style:style});
card.mount('#card-element');
        
          card.addEventListener('change',function (event) {
          var diplayErro = document.getElementById('card-errors');
          if(event.error)
          {
            displayError.textContext = event.error.message;
          }
          else{
            displayError.textContext = 'Error'
          }
          });
        


        var form = document.getElementById('stripe-form');
        form.addEventListener('submit',function (event) {
          event.preventDefault();


          stripe.createToken(card).then(function (result) {
            if(result.error)
            {
              var errorEleent = document.getElementById('card-errors');
              errorEleent.textContext = result.error.message;
            }
            else{
              stripeTokenHandler(result.token)  ;
            }
          })


        })


        function stripeTokenHandler(token) {
          var form = document.getElementById('stripe-form');
          var hiddenInput = document.createElement('input');
          hiddenInput.setAttribute('type','hidden');
          hiddenInput.setAttribute('name','stripeToken');
          hiddenInput.setAttribute('value',token.id);
          form.appendChild(hiddenInput);

          form.submit();




        }

  </script>

-->


{% endblock content %}


